#[derive(serde::Serialize)]
pub struct DataView {
	data: Vec<u8>
}

impl DataView {
	pub fn new(data: &[u8]) -> DataView {
		DataView { data: data.to_owned() }
	}

	pub fn len(&self) -> usize {
		self.data.len()
	}

	pub fn chunk(&self, start: usize, size: usize) -> DataView {
		DataView { data: self.data[start..(start+size)].to_owned() }
	}

	pub fn get_u8(&self, i: usize) -> u8 {
		self.data[i]
	}

	pub fn get_u16(&self, i: usize) -> u16 {
		u16::from_le_bytes([self.data[i], self.data[i+1]])
	}

	pub fn get_i16(&self, i: usize) -> i16 {
		i16::from_le_bytes([self.data[i], self.data[i+1]])
	}

	pub fn get_u32(&self, i: usize) -> u32 {
		u32::from_le_bytes([self.data[i], self.data[i+1], self.data[i+2], self.data[i+3]])
	}

	pub fn get_bits(&self, i: usize, len: usize) -> Vec<u8> {
		let mut bits = Vec::new();
		for j in 0..len {
			let byte = self.data[i+j];
			for b in (0..8).rev() {
				let bit = (byte >> b) & 1;
				bits.push(bit);
			}
		}
		bits
	}

	pub fn get_encoded_string(&self, i: usize, len: usize) -> String {
		let mut value = String::new();
		for j in 0..len {
			let c = self.get_u16(i + j*2);
			if c > 0 {
				value.push_str(&get_encoded_char(c));
			}
		}
		value
	}
}

pub fn get_encoded_char(word: u16) -> String {
	match word {
		0 => "â–ˆ",
		1 => " ",
		2 => "0",
		3 => "1",
		4 => "2",
		5 => "3",
		6 => "4",
		7 => "5",
		8 => "6",
		9 => "7",
		10 => "8",
		11 => "9",
		12 => "+",
		13 => "-",
		14 => "â†µ",
		15 => "ã‚",
		16 => "ã„",
		17 => "ã†",
		18 => "ãˆ",
		19 => "ãŠ",
		20 => "ã‹",
		21 => "ã",
		22 => "ã",
		23 => "ã‘",
		24 => "ã“",
		25 => "ã•",
		26 => "ã—",
		27 => "ã™",
		28 => "ã›",
		29 => "ã",
		30 => "ãŸ",
		31 => "ã¡",
		32 => "ã¤",
		33 => "ã¦",
		34 => "ã¨",
		35 => "ãª",
		36 => "ã«",
		37 => "ã¬",
		38 => "ã­",
		39 => "ã®",
		40 => "ã¯",
		41 => "ã²",
		42 => "ãµ",
		43 => "ã¸",
		44 => "ã»",
		45 => "ã¾",
		46 => "ã¿",
		47 => "ã‚€",
		48 => "ã‚",
		49 => "ã‚‚",
		50 => "ã‚„",
		51 => "ã‚†",
		52 => "ã‚ˆ",
		53 => "ã‚‰",
		54 => "ã‚Š",
		55 => "ã‚‹",
		56 => "ã‚Œ",
		57 => "ã‚",
		58 => "ã‚",
		59 => "ã‚’",
		60 => "ã‚“",
		61 => "ã",
		62 => "ãƒ",
		63 => "ã…",
		64 => "ã‡",
		65 => "ã‰",
		66 => "ã£",
		67 => "ã‚ƒ",
		68 => "ã‚…",
		69 => "ã‚‡",
		70 => "ãŒ",
		71 => "ãŽ",
		72 => "ã",
		73 => "ã’",
		74 => "ã”",
		75 => "ã–",
		76 => "ã˜",
		77 => "ãš",
		78 => "ãœ",
		79 => "ãž",
		80 => "ã ",
		81 => "ã¢",
		82 => "ã¥",
		83 => "ã§",
		84 => "ã©",
		85 => "ã°",
		86 => "ã³",
		87 => "ã¶",
		88 => "ã¹",
		89 => "ã¼",
		90 => "ã±",
		91 => "ã´",
		92 => "ã·",
		93 => "ãº",
		94 => "ã½",
		95 => "ã‚¢",
		96 => "ã‚¤",
		97 => "ã‚¦",
		98 => "ã‚¨",
		99 => "ã‚ª",
		100 => "ã‚«",
		101 => "ã‚­",
		102 => "ã‚¯",
		103 => "ã‚±",
		104 => "ã‚³",
		105 => "ã‚µ",
		106 => "ã‚·",
		107 => "ã‚¹",
		108 => "ã‚»",
		109 => "ã‚½",
		110 => "ã‚¿",
		111 => "ãƒ",
		112 => "ãƒ„",
		113 => "ãƒ†",
		114 => "ãƒˆ",
		115 => "ãƒŠ",
		116 => "ãƒ‹",
		117 => "ãƒŒ",
		118 => "ãƒ",
		119 => "ãƒŽ",
		120 => "ãƒ",
		121 => "ãƒ’",
		122 => "ãƒ•",
		123 => "ãƒ˜",
		124 => "ãƒ›",
		125 => "ãƒž",
		126 => "ãƒŸ",
		127 => "ãƒ ",
		128 => "ãƒ¡",
		129 => "ãƒ¢",
		130 => "ãƒ¤",
		131 => "ãƒ¦",
		132 => "ãƒ¨",
		133 => "ãƒ©",
		134 => "ãƒª",
		135 => "ãƒ«",
		136 => "ãƒ¬",
		137 => "ãƒ­",
		138 => "ãƒ¯",
		139 => "ãƒ²",
		140 => "ãƒ³",
		141 => "ã‚¡",
		142 => "ã‚£",
		143 => "ã‚¥",
		144 => "ã‚§",
		145 => "ã‚©",
		146 => "ãƒƒ",
		147 => "ãƒ£",
		148 => "ãƒ¥",
		149 => "ãƒ§",
		150 => "ã‚¬",
		151 => "ã‚®",
		152 => "ã‚°",
		153 => "ã‚²",
		154 => "ã‚´",
		155 => "ã‚¶",
		156 => "ã‚¸",
		157 => "ã‚º",
		158 => "ã‚¼",
		159 => "ã‚¾",
		160 => "ãƒ€",
		161 => "ãƒ‚",
		162 => "ãƒ…",
		163 => "ãƒ‡",
		164 => "ãƒ‰",
		165 => "ãƒ",
		166 => "ãƒ“",
		167 => "ãƒ–",
		168 => "ãƒ™",
		169 => "ãƒœ",
		170 => "ãƒ‘",
		171 => "ãƒ”",
		172 => "ãƒ—",
		173 => "ãƒš",
		174 => "ãƒ",
		175 => "ãƒ´",
		176 => "ãƒ¼",
		177 => "ï½ž",
		178 => "â€¦",
		179 => "ã€",
		180 => "ã€‚",
		181 => "(",
		182 => ")",
		183 => "ã€Œ",
		184 => "ã€",
		185 => ".",
		186 => "â€¢",
		187 => "!",
		188 => "?",
		189 => "&",
		190 => "â—‹",
		191 => "âœ•",
		192 => "â™¥",
		193 => "â˜€",
		194 => "â˜…",
		195 => "ê©œ",
		196 => "â™ª",
		197 => "â•¬",
		198 => "â¤´",
		199 => "â¤µ",
		200 => "â†’",
		201 => "â†",
		202 => "$",
		203 => "%",
		204 => "A",
		205 => "B",
		206 => "C",
		207 => "D",
		208 => "E",
		209 => "F",
		210 => "G",
		211 => "H",
		212 => "I",
		213 => "J",
		214 => "K",
		215 => "L",
		216 => "M",
		217 => "N",
		218 => "O",
		219 => "P",
		220 => "Q",
		221 => "R",
		222 => "S",
		223 => "T",
		224 => "U",
		225 => "V",
		226 => "W",
		227 => "X",
		228 => "Y",
		229 => "Z",
		230 => "Â¡",
		231 => "_",
		232 => "â€ ",
		233 => "ðŸ˜„",
		234 => "ðŸ˜£",
		235 => "ðŸ˜¤",
		236 => "ðŸ˜‘",
		237 => "ðŸ˜µ",
		238 => "ðŸ˜¢",
		239 => "ðŸ±",
		240 => "â±",
		241 => "ðŸŽ‚",
		242 => "ðŸŽ",
		243 => "ðŸ“±",
		244 => "ðŸ¢",
		245 => "ðŸ’¼",
		246 => "ðŸ™",
		247 => "ðŸ°",
		248 => "âœ¨",
		249 => "ðŸŸ¥",
		61440 => "<br>",
		61441 => "<br>ãƒ¼ãƒ¼ãƒ¼<br>", //new page
		61442 => "{username}",
		61443 => "{charname}",
		61444 => "{ndesu}",
		61445 => "{ndesuka}",
		61446 => "{desuka}",
		61447 => "{lastfood}",
		61448 => "{pronoun}",
		61449 => "{nickname}",
		61450 => "{friend}",
		_ => ""
	}.to_string()
}
